### "亲戚关系"算法

snippet: python学习实例

> https://gitee.com/crossin/snippet

snippet: python学习实例

> https://gitee.com/ahviplc/snippet

中国亲戚关系python移植版 relationship · crossin/snippet - 码云 - 开源中国

> https://gitee.com/crossin/snippet/tree/master/relationship

中国亲戚关系原版js版本 mumuy/relationship: Chinese kinship system.中国亲戚关系计算器 - 家庭称谓/称呼计算/亲戚关系算法

> https://github.com/mumuy/relationship

ahviplc/relationship: Chinese kinship system.中国亲戚关系计算器 - 家庭称谓/称呼计算/亲戚关系算法

> https://github.com/ahviplc/relationship

中国亲戚关系计算器

> https://passer-by.com/relationship/

js版原理详解：

```
目前市面上“亲戚关系”算法主要采用：称谓-直接关系-称谓的方式查找

数据结构

'爸爸': {

'爸爸': '爷爷',

'妈妈': '奶奶',

'哥哥': '伯父',

'弟弟': '叔叔',

'姐姐': '姑妈',

'妹妹': '姑妈',

'丈夫': '未知',

'妻子': '妈妈',

'儿子': {'older': '哥哥', 'middle': '我', 'younger': '弟弟'},

'女儿': {'older': '姐姐', 'middle': '我', 'younger': '妹妹'}

}

这样的结构主要有以下问题：

1.无法直接查询如：“舅妈的婆婆”这样的复合关系；

2.称谓无法逆向查询，如：“表哥的妈妈”的妈妈是“舅妈”、“姨妈”还是“姑妈”？

3.数据结构不好，数据臃肿。关注中会出现多个“未知”

4.无法兼容多种称呼，如：“爸爸”也可以叫“父亲”、“爹地”

5.无法进行关系拓扑，如：“舅妈”和我什么关系？

而我的这套算法才用的是：关系链-称谓集合的方式查找

演示地址：http://passer-by.com/relationship/

项目地址：https://github.com/mumuy/relationship

数据结构

'h':['老公','丈夫','先生','官人','男人','汉子','夫','夫君','相公','夫婿','爱人','老伴'],

'h,f':['公公','翁亲','老公公'],

每个称谓都可以找到相应的关系链，每个关系链同时有对应的称谓集合，这里需要引入自己“发明”的特殊语法标记

语法说明

【关系】f:父,m:母,h:夫,w:妻,s:子,d:女,xb:兄弟,ob:兄,lb:弟,xs:姐妹,os:姐,ls:妹

【修饰符】 1:男性,0:女性,&o:年长,&l:年幼,#:隔断,[a|b]:并列

如：

"f"对应着爸爸，那么："f,m"对应奶奶,"f,f"对应着爷爷；

这样在查询关系的时候，只需要对关系链进行计算就好了，而不是对称谓进行字典查找

算法思路

1.当用户输入“舅妈的婆婆”，可以分解出两个对象“舅妈”和“婆婆”（前者的婆婆）

2.从“关系链-称谓集合”映射关系可知，这两个对象的关系链分别是："m,xb,w"和"h,m",合并后的关系即："m,xb,w,h,m"

3.这时候关系链会出现冗余，如：

"w,h"表示“老婆的老公”,即自己！可以直接将关系链简化成："m,xb,m"。

同理，又出现另外一层冗余，"xb,m"表示“兄弟的妈妈”，即自己的妈妈！于是关系链可以进一步简化为："m,m"

4.这时候即把复杂的关系链转换成直接关系了，直接查询“关系链-称谓集合”映射关系就好

实现

1.“关系链-称谓集合”映射关系可以通过JSON对象的键值对表示，即属性为对应关系链，值为称谓的集合。键值对具有查询速度快的优点。

2.关系链的简化计算可以用正则匹配的方式来实现，规则只需考虑两层关系的简化，多次处理直到不能再简化为止。

如：爸爸的老婆就是妈妈，兄弟的爸爸就是爸爸，老婆的老公就是自己等等

当然简化过程中还需要考虑性别，和多可能性的存在

如：儿子的妈妈，当你为男性时代表你的妻子，当你是女性时就是你自己；妈妈的儿子，可能是你也可能是你兄弟，而当你为女性时，又只能是你兄弟。

这些都是要在正则表达式中匹配条件，然后替换处理！这就是为什么在自己的语法标记中引入【修饰符】的原因了。

#:隔断，分隔的是整条关系链

[a|b]:并列，分隔的是关系链中的单一节点

作者：掉鏈自行車
链接：https://www.jianshu.com/p/74290f1ae838
```

python移植版原理概述:
```
1.定义最基本的原子关系，比如：f:父,m:母,h:夫,w:妻,s:子,d:女,xb:兄弟,ob:兄,lb:弟,xs:姐妹,os:姐,ls:妹

2.通过关系链，表示复合关系，比如：爷爷就是f,f，伯父就是f,ob

3.讲前两点对应关系用字典的方式预先整理好，就是所有关系链到称谓的直接映射

4.定义可简化的关系，比如：哥哥的姐姐就是自己的姐姐，即 xb,xs 就是 xs；母亲的丈夫 m,h 就是父亲 f。这一步的作用是为了将复杂的关系链转化成可查找到的直接关系链

5.为了处理性别、长幼带来的影响，作者还额外定义了一些修饰符：1:男性,0:女性,&o:年长,&l:年幼,#:隔断,[a|b]:并列

6.定义好以上信息好，当获取用户的输入后，将其转化成关系符号，再递归简化关系链，直到不可再简化为止，再去映射关系中查找称呼
```